/*! sequence-viewer 2015-11-04 */
var Sequence=function(){function a(a,b){function c(a,b,c){(new Date).getTime();0===a.length&&$(u+" #fastaSeq").html(x);var e=x,f=e.toString(),g=0,h=0;for(i in a)g=d(a[i].start),h=d(a[i].end),f=f.substring(0,g)+"<span class='stringsSelected' style=\"background:"+b+';color:white;">'+f.substring(g,h)+"</span>"+f.substring(h,f.length);$(u+" #fastaSeq").html(f)}function d(a){var b=a+~~(a/10)+4*~~(a/y);return b}function e(a,b){for(var c=$(a).html().split("<br>"),d=parseInt($(a).attr("display-option")),e=[],f=0,g=0;g<c.length;g++)e.push(f+1+"<br>"),f+=d;$(b).html(e.join(""))}function f(a){var b=parseInt($(a).attr("display-option"));b=(b+b/10).toString();var c=$(a).html();c=c.toString().match(/.{1,10}/g).join(" ").match(new RegExp(".{1,"+b+"}","g")).join("<br>"),$(a).html(c)}function g(){$(u+" #sequenceHeader").append('<input id="inputSearchSeq" type="text" class="form-control pull-right" style="width:40%;margin-top:3px;" placeholder="Search in sequence.. (Regex supported)">'),h()}function h(){$(u+" #inputSearchSeq").keyup(function(){var b=$(this).val();if(""!==b){for(var d,e=new RegExp(b,"gi"),f=[];null!=(d=e.exec(a));)f.push({start:d.index,end:d.index+d[0].length});f.sort(function(a,b){return b.start-a.start}),j(f),c(f,"#C50063")}else $(u+" #fastaSeq").html(x)})}function j(b){var c=k(b,a);c&&l(c)}function k(a,b){var c=[];return a.length&&a.forEach(function(a){c.push({start:a.start+1,end:a.end,sequence:b.substring(a.start,a.end)})}),c}function l(a){if(CustomEvent){var b=new CustomEvent(r.events.SEQUENCE_SELECTED_EVENT,{detail:a});w.dispatchEvent(b)}else console.warn("CustomEvent is not defined....");r.trigger&&r.trigger(r.events.SEQUENCE_SELECTED_EVENT,a)}function m(){$(u+" #fastaSeq").mouseup(function(){var a=n();a&&o(a)})}function n(){var a=window.getSelection().toString();return a=a.replace(/\s+/g,"")}function o(a){if(CustomEvent){var b=new CustomEvent(r.events.MOUSE_SELECTION_EVENT,{detail:{selection:a}});w.dispatchEvent(b)}else console.warn("CustomEvent is not defined....");r.trigger&&r.trigger(r.events.MOUSE_SELECTION_EVENT,{selection:a})}function p(a){var b=v;b.charsPerLine=a.value,r.render(u,b)}function q(){var a=["50","60","70","80","90","100"],b='<form class="form-inline" role="form"><div id="sequenceToolbar" class="row"style="margin-bottom:15px;"><div class="input-group" style="margin-left:20px;"> <span class="input-group-addon">Char per line</i></span><select id="CPLChoice" class="form-control" style="border-top-left-radius: 0px;border-bottom-left-radius: 0px;"><option>Select</option>{{#each CPL}}<option value={{this}}>{{this}}</option>{{/each}}</select></div></div></form>',c=Handlebars.compile(b),d=c({CPL:a});$(u+" #sequenceBody").prepend(d),$(u+" #CPLChoice").change(function(){p(this),$(u+" #CPLChoice option:selected").text($(this).val())})}var r=this;this.events={MOUSE_SELECTION_EVENT:"sequence-viewer-mouse-selection",SEQUENCE_SELECTED_EVENT:"sequence-viewer-substring-selected"};var s;s=void 0!==b?b:"",console.log(s);var t,u,v,w,a=a,x="",y=0;this.render=function(b,c){if(u=b,w=document.getElementById(b.substring(1)),"undefined"==typeof c)var c={showLineNumbers:!0,wrapAminoAcids:!0,charsPerLine:30,search:!1,toolbar:!1,title:"Protein Sequence"};else v=c;y="undefined"==typeof c.charsPerLine?30:c.charsPerLine,t="undefined"==typeof c.title?"Protein Sequence":c.title;var d='<div id="sequenceHeader" class="row" style="border-bottom: 1px solid #E7EAEC;padding-bottom:5px;margin:0px 0px 15px"><div style="display:inline-block;"><span class="badge" style="border-radius:70%;border: 2px solid black;color:#C50063;padding:8px 5px;background-color:white;margin-right:10px;vertical-align:middle;">{{sequenceLength}}</span></div><h4 style="display:inline-block;vertical-align:middle;">'+t+'</h4></div><div id="sequenceBody" style="margin-top: 5px;"><div id="scroller" style="max-height:400px;overflow:auto;white-space: nowrap;padding-right:20px;margin-right:10px;s"><div id="charNumbers" style="font-family: monospace;font-size: 13px;display:inline-block;text-align:right; padding-right:5px; border-right:1px solid LightGray;"></div><div id="fastaSeq" display-option="'+y+'" style="font-family: monospace;font-size: 13px;display:inline-block;padding:5px;">{{{sequence}}}</div></div><div id="coverageLegend" style="margin-top: 10px;margin-left:15px;"></div></div>',h=Handlebars.compile(d),i=h({sequence:a,sequenceLength:a.length});$(b).html(i),c.wrapAminoAcids!==!1?f(b+" #fastaSeq"):$(b+" #scroller").css("overflow-x","auto"),c.showLineNumbers!==!1&&e(b+" #fastaSeq",b+" #charNumbers"),c.search&&g(),c.toolbar&&(q(),""!==s&&$("#sequenceToolbar").append('<a class="btn btn-default" href="http://www.nextprot.org/db/entry/'+s.split("-")[0]+"/fasta?isoform="+s.slice(3)+'" style="margin-left:15px;">view Fasta</a><a class="btn btn-default disabled" href="" style="margin-left:15px;">Blast sequence</a><a class="btn btn-default disabled" href="" style="margin-left:15px;">Blast selection</a>')),x=$(b+" #fastaSeq").html(),m()},this.selection=function(a,b,c,d){var e=[a,b],f=x;j([{start:a,end:b}]),e[0]=e[0]+~~(e[0]/10)+4*~~(e[0]/y),e[1]=e[1]+~~(e[1]/10)+4*~~(e[1]/y);f=f.substring(0,e[0])+"<span id='stringSelected' style=\"background:"+c+';color:white;">'+f.substring(e[0],e[1])+"</span>"+f.substring(e[1],f.length),$(u+" #fastaSeq").html(f)},this.addLegend=function(a){for(var b=0;b<a.length;b++)a[b].underscore===!0?$(u+" #coverageLegend").append('<div style="display:inline-block;background:'+a[b].color+';width:20px;height:20px;vertical-align:middle;margin:0px 5px 0px 10px;border-radius:50%; border: 1px solid grey;text-align:center; line-height:0.8;">_</div><p style="display:inline-block;font-weight:bold;font-size:11px;font-style:italic;margin:0;padding-top:3px;vertical-align:top;">'+a[b].name+"</p></div>"):$(u+" #coverageLegend").append('<div style="display:inline-block;background:'+a[b].color+';width:20px;height:20px;vertical-align:middle;margin:0px 5px 0px 10px;border-radius:50%;"></div><p style="display:inline-block;font-weight:bold;font-size:11px;font-style:italic;margin:0;padding-top:3px;vertical-align:top;">'+a[b].name+"</p>")},this.coverage=function(a,b,c,e){a.sort(function(a,b){return a.start-b.start});(new Date).getTime();if(!b)var b=0;if(!c)var c=0;if(!e)var e="#FFE5A3";for(var f="",g="",h=0;h<a.length;h++)a[h].underscore?(g='<span style="text-decoration:underline;color:'+a[h].color+';">',f+=g):(g='<span style="color:'+a[h].color+';">',f+=g),c?b>=a[h].start&&b<a[h].end&&c>=a[h].start&&c<a[h].end?(f+=x.substring(d(a[h].start),d(b))+'<span id="peptideHighlighted" style="background:'+e+';">'+x.substring(d(b),d(c+1)),f+="</span>"+x.substring(d(c+1),d(a[h].end))+"</span>"):f+=b>=a[h].start&&b<a[h].end?x.substring(d(a[h].start),d(b))+'</span><span id="peptideHighlighted" style="background:'+e+';">'+g+x.substring(d(b),d(a[h].end))+"</span>":c>=a[h].start&&c<a[h].end?x.substring(d(a[h].start),d(c+1))+"</span></span>"+g+x.substring(d(c+1),d(a[h].end))+"</span>":x.substring(d(a[h].start),d(a[h].end))+"</span>":f+=x.substring(d(a[h].start),d(a[h].end))+"</span>";$(u+" #fastaSeq").html(f)},this.onMouseSelection=function(a){w.addEventListener(r.events.MOUSE_SELECTION_EVENT,a)},this.onSubpartSelected=function(a){w.addEventListener(r.events.SEQUENCE_SELECTED_EVENT,a)}}return a}();"object"==typeof module&&"object"==typeof module.exports&&(module.exports=Sequence);